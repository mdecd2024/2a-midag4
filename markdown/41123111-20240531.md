---
Title: w15
Date: 2024-05-31 11:00
Category: w15
Tags: w15
Slug: 41123111-2024-week-15-ç¶²èªŒğŸ˜
Author: 41123111
---
èˆ‡chatgptè¨è«–ç¶²éš›ç¶œåˆçƒé¡ç«¶è³½æ©Ÿå™¨äººçš„ç¨‹å¼:
from zmqRemoteApi import RemoteAPIClient
import keyboard
import math
import time

client = RemoteAPIClient('localhost', 23000)

print('Program started')
sim = client.getObject('sim')

print('Simulation started')

# ä»åœºæ™¯ä¸­è·å– a_player1, Sphere å’Œ sensor3
a_player1 = sim.getObject('/a_player1')
Sphere = sim.getObject('/Sphere')
sensor3 = sim.getObject('/sensor3')

# å®šä¹‰å°†çƒæ”¾åœ¨çƒå‘˜å¤´ä¸Šçš„åŠŸèƒ½
def place_ball_on_head():
    try:
        # è·å–çƒå‘˜çš„ä½ç½®
        player_position = sim.getObjectPosition(a_player1, -1)

        # è®¡ç®—çƒçš„ä½ç½®ï¼Œåœ¨çƒå‘˜çš„å¤´ä¸Šæ–¹
        head_position = [
            player_position[0],  # åœ¨ x è½´ä¸Šä¿æŒä¸å˜
            player_position[1],  # åœ¨ y è½´ä¸Šä¿æŒä¸å˜
            player_position[2] + 0.3  # åœ¨ z è½´ä¸Šç•¥å¾®æŠ¬é«˜
        ]

        # è®¾ç½®çƒçš„ä½ç½®
        sim.setObjectPosition(Sphere, -1, head_position)
        print("Ball placed on the player's head.")

    except Exception as e:
        print(f"Error while placing ball on head: {e}")

# å®šä¹‰æŠ•ç¯®åŠŸèƒ½
def shoot():
    try:
        # è·å–çƒçš„ä½ç½®
        ball_position = sim.getObjectPosition(Sphere, -1)

        # è®¾ç½®çƒçš„åˆå§‹é€Ÿåº¦ï¼Œä½¿å…¶å…·æœ‰æ‹‹ç‰©çº¿è¿åŠ¨
        throw_force = 90.0
        pitch_angle = 45.0 * math.pi / 180  # æŠ•ç¯®è§’åº¦å›ºå®šåœ¨45åº¦
        force_vector = [
            0,  # åœ¨ x è½´ä¸ŠåŠ›ä¸º0
            throw_force * math.cos(pitch_angle),  # åœ¨ y è½´ä¸Šçš„åŠ›
            throw_force * math.sin(pitch_angle)  # åœ¨ z è½´ä¸Šçš„åŠ›ï¼Œå‘ä¸Š
        ]

        # å¯¹çƒæ–½åŠ åŠ›
        sim.addForceAndTorque(Sphere, force_vector, [0, 0, 0])
        print("Ball thrown with force.")

    except Exception as e:
        print(f"Error while shooting: {e}")

# å®šä¹‰æ§åˆ¶çƒå‘˜ç§»åŠ¨çš„å‡½æ•°
def move_player(direction):
    speed = 0.05  # çƒå‘˜ç§»åŠ¨é€Ÿåº¦
    # æ ¹æ®æ–¹å‘è®¡ç®—ç§»åŠ¨å¢é‡
    if direction == 's':
        delta_position = [speed, 0, 0]  # åœ¨ x è½´ä¸Šå‘å‰ç§»åŠ¨
    elif direction == 'w':
        delta_position = [-speed, 0, 0]  # åœ¨ x è½´ä¸Šå‘åç§»åŠ¨
    elif direction == 'd':
        delta_position = [0, speed, 0]  # åœ¨ y è½´ä¸Šå‘å³ç§»åŠ¨
    elif direction == 'a':
        delta_position = [0, -speed, 0]  # åœ¨ y è½´ä¸Šå‘å·¦ç§»åŠ¨
    else:
        delta_position = [0, 0, 0]  # ä¸ç§»åŠ¨

    # è·å–å½“å‰çƒå‘˜ä½ç½®
    current_position = sim.getObjectPosition(a_player1, -1)
    # è®¡ç®—æ–°çš„ä½ç½®
    new_position = [current_position[0] + delta_position[0], current_position[1] + delta_position[1], current_position[2] + delta_position[2]]
    # æ›´æ–°çƒå‘˜ä½ç½®
    sim.setObjectPosition(a_player1, -1, new_position)

# ä¸»å¾ªç¯ï¼Œç›‘å¬é”®ç›˜è¾“å…¥
while True:
    try:
        # ç›‘å¬é”®ç›˜è¾“å…¥ï¼Œæ ¹æ®æŒ‰é”®æ§åˆ¶çƒå‘˜ç§»åŠ¨
        if keyboard.is_pressed('s'):
            move_player('s')
        elif keyboard.is_pressed('w'):
            move_player('w')
        elif keyboard.is_pressed('d'):
            move_player('d')
        elif keyboard.is_pressed('a'):
            move_player('a')
        if keyboard.is_pressed('1'):
            place_ball_on_head()

        # æ£€æŸ¥ sensor3 æ˜¯å¦æ„Ÿæµ‹åˆ°çƒ
        sensor_state = sim.readProximitySensor(sensor3)
        if sensor_state[0]:  # å¦‚æœæ„Ÿæµ‹åˆ°çƒ
            shoot()
        
        # æ·»åŠ çŸ­æš‚å»¶è¿Ÿï¼Œé¿å…å ç”¨è¿‡å¤šCPUèµ„æº
        time.sleep(0.01)
    
    except KeyboardInterrupt:
        print("Program interrupted")
        break
    except Exception as e:
        print(f"Error in main loop: {e}")
        break
